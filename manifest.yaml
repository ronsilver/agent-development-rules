# =============================================================================
# Agent Development Rules - Manifest de Configuración v2.0
# =============================================================================
# Este archivo define la configuración central para sincronizar reglas
# a diferentes agentes de AI (Windsurf, GitHub Copilot, Cursor, Antigravity, etc.)
#
# Uso: ./scripts/sync.sh [--agent <nombre>] [--dry-run]
# =============================================================================

version: "2.0"

# =============================================================================
# Directorio de contenido (nueva estructura organizada)
# =============================================================================

content_dir: "content"

rules:
  source_dir: "rules"
  files:
    # Core - 6 pilares del agente (siempre en contexto)
    - core/agent-behavior.md
    # Quality - Linting (glob-triggered)
    - quality/linting.md
    # Process - Git (glob-triggered)
    - process/git.md
    # Agents - Comportamiento específico por agente
    - agents/windsurf.md
    - agents/copilot.md

workflows:
  source_dir: "workflows"
  files:
    # Validation
    - validation/validate.md
    - validation/test.md
    - validation/lint.md
    # Git
    - git/pre-push.md
    - git/pr-review.md
    - git/fix-pr-comments.md
    # Infrastructure
    - infrastructure/terraform-module.md
    - infrastructure/docker-build.md
    - infrastructure/k8s-validate.md
    # Security
    - security/security-check.md

prompts:
  source_dir: "prompts"
  files:
    - review.prompt.md
    - security.prompt.md
    - test.prompt.md
    - refactor.prompt.md
    - document.prompt.md
    - validate.prompt.md
    - commit.prompt.md
    - explain.prompt.md
    - debug.prompt.md
    - optimize.prompt.md

skills:
  source_dir: "skills"
  # Skills are directory-based (each entry is a directory name containing SKILL.md)
  # See: https://agentskills.io/specification
  directories:
    - accessibility-compliance
    - aws-cloud-expert
    - code-review
    - docker-expert
    - documentation-generator
    - git-commit-formatter
    - kubernetes-expert
    - operational-excellence
    - performance-optimization
    - refactoring
    - scalability-patterns
    - security-audit
    - systematic-debugging
    - terraform-expert
    - test-driven-development
    - verification-before-completion

# =============================================================================
# Configuración por Agente
# =============================================================================

agents:
  windsurf:
    enabled: true
    description: "Windsurf IDE / Codeium Cascade"
    detect:
      # Detectar si Windsurf está instalado
      paths:
        - "${HOME}/.codeium"
        - "/Applications/Windsurf.app"
      commands: []
    targets:
      rules:
        path: "${HOME}/.codeium/memories/global_rules.md"
        format: merged
        strip_frontmatter: true
        header: |
          ---
          trigger: always
          ---

          # Reglas de Desarrollo para Windsurf/Cascade

          <!-- Generado automáticamente por sync.sh -->
          <!-- Última actualización: {{timestamp}} -->

      workflows:
        path: "${HOME}/.codeium/global_workflows/default.md"
        format: merged
        strip_frontmatter: true
        header: |
          ---
          name: global-workflows
          description: Workflows globales para Windsurf
          ---

          # Workflows Globales

          <!-- Generado automáticamente por sync.sh -->
          <!-- Última actualización: {{timestamp}} -->

      skills:
        path: "${HOME}/.codeium/windsurf/skills"
        format: directory

  copilot-cli:
    enabled: true
    description: "GitHub Copilot CLI (gh copilot)"
    detect:
      paths: []
      commands:
        - "gh copilot --version"
    targets:
      instructions:
        path: "${HOME}/.config/gh-copilot/instructions.md"
        format: merged
        strip_frontmatter: true
        source_type: "rules"
        header: |
          # GitHub Copilot CLI - Global Instructions

          <!-- Generado automáticamente por sync.sh -->
          <!-- Última actualización: {{timestamp}} -->

  copilot-vscode:
    enabled: true
    description: "GitHub Copilot (VS Code)"
    detect:
      paths:
        - "${HOME}/.vscode/extensions"
      commands:
        - "code --list-extensions 2>/dev/null | grep -q github.copilot"
    targets:
      rules:
        path: "${HOME}/Library/Application Support/Code/User/prompts"
        glob_paths:
          - "${HOME}/.vscode/extensions/github.copilot-chat-*/assets/prompts"
        format: merged
        output_filename: "Default.instructions.md"
        strip_frontmatter: true
        header: |
          ---
          applyTo: "**"
          description: Instrucciones globales de desarrollo
          ---

          <!-- Generado automáticamente por sync.sh -->
          <!-- Última actualización: {{timestamp}} -->

      prompts:
        path: "${HOME}/Library/Application Support/Code/User/prompts"
        format: merged
        output_filename: "default.prompt.md"
        strip_frontmatter: true
        header: |
          ---
          description: Prompts reutilizables para tareas comunes
          ---

          <!-- Generado automáticamente por sync.sh -->
          <!-- Última actualización: {{timestamp}} -->

      skills:
        path: "${HOME}/.copilot/skills"
        format: directory

  copilot-intellij:
    enabled: true
    description: "GitHub Copilot (IntelliJ/JetBrains)"
    detect:
      paths:
        - "${HOME}/Library/Application Support/JetBrains/*/plugins/github-copilot-intellij"
      commands: []
    targets:
      rules:
        path: "${HOME}/.config/github-copilot/intellij"
        format: merged
        output_filename: "Default.instructions.md"
        strip_frontmatter: true
        header: |
          ---
          applyTo: "**"
          description: Instrucciones globales de desarrollo
          ---

          <!-- Generado automáticamente por sync.sh -->
          <!-- Última actualización: {{timestamp}} -->

      prompts:
        path: "${HOME}/.config/github-copilot/intellij"
        format: merged
        output_filename: "default.prompt.md"
        strip_frontmatter: true
        header: |
          ---
          description: Prompts reutilizables para tareas comunes
          ---

          <!-- Generado automáticamente por sync.sh -->
          <!-- Última actualización: {{timestamp}} -->

  cursor:
    enabled: true
    description: "Cursor IDE"
    detect:
      paths:
        - "/Applications/Cursor.app"
        - "${HOME}/.cursor"
      commands: []
    targets:
      rules:
        path: "${HOME}/.cursor/rules"
        format: merged
        output_filename: "global.mdc"
        strip_frontmatter: true
        header: |
          ---
          description: "Global development rules"
          globs: []
          alwaysApply: true
          ---

          <!-- Generado automáticamente por sync.sh -->
          <!-- Última actualización: {{timestamp}} -->

  claude-code:
    enabled: true
    description: "Claude Code (Anthropic)"
    detect:
      paths:
        - "${HOME}/.claude"
      commands: []
    targets:
      rules:
        path: "${HOME}/.claude/CLAUDE.md"
        format: merged
        strip_frontmatter: true
        header: |
          # Claude Code - Global Instructions

          <!-- Generado automáticamente por sync.sh -->
          <!-- Última actualización: {{timestamp}} -->

      skills:
        path: "${HOME}/.claude/skills"
        format: directory

  codex-cli:
    enabled: true
    description: "OpenAI Codex CLI"
    detect:
      paths: []
      commands:
        - "codex --version"
    targets:
      rules:
        path: "${HOME}/.codex/AGENTS.md"
        format: merged
        strip_frontmatter: true
        header: |
          # Codex CLI - Global Instructions

          <!-- Generado automáticamente por sync.sh -->
          <!-- Última actualización: {{timestamp}} -->

  gemini-cli:
    enabled: true
    description: "Google Gemini CLI"
    detect:
      paths: []
      commands:
        - "gemini --version"
    targets:
      rules:
        path: "${HOME}/.gemini/GEMINI.md"
        format: merged
        strip_frontmatter: true
        header: |
          # Gemini CLI - Global Instructions

          <!-- Generado automáticamente por sync.sh -->
          <!-- Última actualización: {{timestamp}} -->

  antigravity:
    enabled: true
    description: "Google Antigravity IDE"
    detect:
      paths:
        - "/Applications/Antigravity.app"
        - "${HOME}/.gemini/antigravity"
      commands: []
    targets:
      rules:
        path: "${HOME}/.gemini/GEMINI-antigravity.md"
        format: merged
        strip_frontmatter: true
        header: |
          # Google Antigravity - Global Instructions

          <!-- Generado automáticamente por sync.sh -->
          <!-- Última actualización: {{timestamp}} -->

      workflows:
        path: "${HOME}/.gemini/antigravity/global_workflows"
        format: merged
        output_filename: "default.md"
        strip_frontmatter: true
        header: |
          # Antigravity - Global Workflows

          <!-- Generado automáticamente por sync.sh -->
          <!-- Última actualización: {{timestamp}} -->

      skills:
        path: "${HOME}/.gemini/antigravity/skills"
        format: directory

  opencode:
    enabled: true
    description: "OpenCode"
    detect:
      paths: []
      commands:
        - "opencode --version"
    targets:
      rules:
        path: "${HOME}/.opencode/AGENTS.md"
        format: merged
        strip_frontmatter: true
        header: |
          # OpenCode - Global Instructions

          <!-- Generado automáticamente por sync.sh -->
          <!-- Última actualización: {{timestamp}} -->

  local-project:
    enabled: false
    description: "Copiar reglas a proyecto local"
    targets:
      rules:
        path: "${REPO_ROOT}/.windsurf/rules"
        format: merged
        output_filename: "global.md"
        strip_frontmatter: true
        header: |
          ---
          trigger: always
          ---

          # Project Rules

          <!-- Generado automáticamente por sync.sh -->
          <!-- Última actualización: {{timestamp}} -->

      workflows:
        path: "${REPO_ROOT}/.windsurf/workflows"
        format: merged
        output_filename: "default.md"
        strip_frontmatter: true
        header: |
          ---
          name: project-workflows
          description: Workflows del proyecto
          ---

          <!-- Generado automáticamente por sync.sh -->
          <!-- Última actualización: {{timestamp}} -->
